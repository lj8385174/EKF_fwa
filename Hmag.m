function [H] = Hmag(X)
% measurement matrix of  
H = zeros(3,22);
q  = X(1:4);
mage = X(17:19);
H(:,1) = 2*[q(1),q(4),-q(3);-q(4),+q(1),+q(2);q(3),-q(2),+q(1)]*mage;
H(:,2) = 2*[q(2),+q(3),+q(4);q(3),-q(2),+q(1);q(4),-q(1),-q(2)]*mage;
H(:,3) = 2*[-q(3),q(2),-q(1);q(2),q(3),q(4);q(1),q(4),-q(3)]*mage;
H(:,4) = 2*[-q(4),q(1),q(2);-q(1),-q(4),q(3);q(2),q(3),q(4)]*mage;

H(:,17:19)=[q(1)^2+q(2)^2-q(3)^2-q(4)^2,2*(q(2)*q(3)+q(1)*q(4)),2*(q(2)*q(4)-q(1)*q(3));2*(q(2)*q(3)-q(1)*q(4)),q(1)^2-q(2)^2+q(3)^2-q(4)^2,2*(q(3)*q(4)+q(1)*q(2));2*(q(2)*q(4)+q(1)*q(3)),2*(q(3)*q(4)-q(1)*q(2)),q(1)^2-q(2)^2-q(3)^2+q(4)^2];

H(:,20:22) = eye(3);